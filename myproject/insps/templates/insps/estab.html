{% extends "base.html" %}

{% block rest_insp_list %}

<div id="estab_container">
    <h2 id="estab_name_header">{{ estab.0.estab_id.name }}, {{ estab.0.estab_id.address}}</h2>

    <hr class="style-one">


    <div class="clear_floats"></div>
    <!--<div id="list4-estab_summary">
        <ul>
            {% for inspection in estab %}

                <li><a href="/insps/{{ inspection.inspection_key }}/">{{ inspection.date }}:  {{ inspection.demerits_nums }} demerit{{ inspection.demerits_nums|pluralize }}.</li></a>

            {% endfor %}
        </ul>
    </div>-->

    {% if estab.count > 1 %}
    <div id="estab_chart">
        <script type="text/javascript">
            var json =  [
                        {% for inspection in estab %}
                            {
                                "date": "{{ inspection.date }}",
                                "demerits": {{ inspection.demerits_nums }},
                                'inspection_key': "{{ inspection.inspection_key }}" 

                            }{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        ];

            //var demerits_js = new Array();
            var demerits_js = new Array;
            var dates_js = new Array();

            $.map(json, function(obj, i) {
                //demerits_js.push(parseInt(obj.demerits));
                //demerits_js = { y: parseInt(obj.demerits), inspection_key : obj.inspection_key }
                demerits_js.push({ y: parseInt(obj.demerits), inspection_key: obj.inspection_key });
                dates_js.push((obj.date));

            });

            console.log(demerits_js);
            $(function () {
                $('#estab_chart').highcharts({
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'Inspection Results',
                        style: {
                            fontFamily:'Georgia, Times, serif' 
                        }
                    },
                    subtitle: {
                        text: 'San Antonio Metropolitan Health District',
                        style: {
                            fontFamily:'Georgia, Times, serif' 
                        }
                    },
                    xAxis: {
                        categories: dates_js
                    },
                    yAxis: {
                        title: {
                            text: 'Demerits'
                        }
                    },
                    tooltip: {
                        enabled: true, 
                        formatter: function() {
                            return 'The value for <b>' + this.x + '</b> is <b>' + this.y + '</b>, in series '+ this.series.name;
                        }
                    },
                    series: [{
                        showInLegend: false,
                        data: demerits_js,
                        animation: {
                            duration: 4000
                        }
                    }]
                });
            });
        </script>

    </div>
    {% endif %}

    <!--<div id="inspection_exposi">
    <p class="estab_page_text">this is a paragraph detailing the city's policy about how thye inspect restaurants. i'd write in here for example how they inspect restaurants more often when they're doing poorly and progressive less often as they get better.  i'm not sure what the threshold is.</p>  
    </div>-->

</div>
{% endblock %}