{% extends "base.html" %}

{% block rest_insp_list %}

<div id="estab_container">
    <h2 id="estab_name_header">{{ estab.0.estab_id.name }}, {{ estab.0.estab_id.address}}</h2>

    <hr class="style-one">

    <div id="inspection_exposi">
        <p class="estab_page_text">this is a paragraph detailing the city's policy about how thye inspect restaurants. i'd write in here for example how they inspect restaurants more often when they're doing poorly and progressive less often as they get better.  i'm not sure what the threshold is.</p>  

        <p class="estab_page_text">maybe i'll include an example or two about how a certain number of demerits might affect the inspection schedule for a specfic restaurant.  i'll write some more and then probably a little more and then boom. i'm done. </p>
    </div>
    <div id="estab_summary_list">
        <ul>
            {% for inspection in estab %}

                <li><a href="/insps/{{ inspection.inspection_key }}/">{{ inspection.estab_id.name }}</a> was inspected on {{ inspection.date }} with {{ inspection.demerits_nums }} demerit{{ inspection.demerits_nums|pluralize }}.</li>

            {% endfor %}
        </ul>
    </div>
    <div class="clear_floats"></div>

    {% if estab.count > 1 %}
    <hr class="style-one">
    <div id="estab_chart">
        <script type="text/javascript">
            var json =  [
                        {% for inspection in estab %}
                            {
                                "date": "{{ inspection.date }}",
                                "demerits": {{ inspection.demerits_nums }}
                            }{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        ];

            var demerits_js = new Array();
            var dates_js = new Array();

            $.map(json, function(obj, i) {
                demerits_js.push(parseInt(obj.demerits));
                dates_js.push((obj.date));

            });


            $(function () {
                $('#estab_chart').highcharts({
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'Inspection Results'
                    },
                    subtitle: {
                        text: 'San Antonio Metropolitan Health District'
                    },
                    xAxis: {
                        categories: dates_js
                    },
                    yAxis: {
                        title: {
                            text: 'Demerits'
                        }
                    },
                    tooltip: {
                        enabled: true

                    },
                    plotOptions: {
                        line: {
                            dataLabels: {
                                enabled: false
                            },
                            enableMouseTracking: false
                        }
                    },
                    series: [{
                        showInLegend: false,
                        data: demerits_js
                    }]
                });
            });
        </script>

    </div>
    {% endif %}

</div>
{% endblock %}