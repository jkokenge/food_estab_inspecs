{% extends "base.html" %}

{% block rest_insp_list %}

<div id="estab_container">
    <h2 id="estab_name_header">{{ estab.0.estab_id.name }}, {{ estab.0.estab_id.address}}</h2>

    <hr class="style-one">


    <div class="clear_floats"></div>

    {% if total_demerits > 0 %}
    <div id="estab_chart">
        <script type="text/javascript">
            var json =  [
                        {% for inspection in estab %}
                            {
                                "date": "{{ inspection.date }}",
                                "demerits": {{ inspection.demerits_nums }},
                                'inspection_key': "{{ inspection.inspection_key }}" 

                            }{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        ];

            var demerits_js = new Array;
            var dates_js = new Array();

            $.map(json, function(obj, i) {
                demerits_js.push({ y: parseInt(obj.demerits), inspection_key: obj.inspection_key });
                dates_js.push((obj.date));

            });

            $(function () {
                $('#estab_chart').highcharts({
                    chart: {
                        type: 'scatter'
                    },
                    title: {
                        text: 'Inspection Results',
                        style: {
                            fontFamily:'Sanchez, serif',
                            fontSize:"140%" 
                        }
                    },
                    subtitle: {
                        text: 'San Antonio Metropolitan Health District',
                        style: {
                            fontFamily:'Sanchez, serif',
                            fontSize: "130%" 
                        }
                    },
                    xAxis: {
                        categories: dates_js
                    },
                    yAxis: {
                        labels: {
                            align:'left',
                            x:0,
                            y:-2
                        },
                        title: {
                            text: 'Demerits',
                            style: {
                                fontFamily: 'Sanchez, serif',
                                fontSize: "130%",
                                letterSpacing:'.5px'
                            }
                        },
                        min: 0
                    },
                    tooltip: {
                        enabled: true, 
                        formatter: function() {
                            return 'Demerits: ' + this.point.y + '<br>' + '<a href="http://localhost:8000/insps/' + this.point.inspection_key + '/">Click for details.';
                        }
                    },
                    series: [{
                        showInLegend: false,
                        data: demerits_js,
                        animation: {
                            duration: 4000
                        },
                        marker: {
                            enabled: true,
                            symbol: 'circle',
                            radius: 9,
                            fillColor: 'red'
                        }
                    }]
                });
            });
        </script>

    </div>
    {% else %}
        <div id="no_estabs">
            <p>
                This establishment either has no inspections in the database or the demerit total for all inspections is 0. 
            </p>

        </div>
    {% endif %}

    <div id="inspection_exposi">
    <p id="hover_warning">Hover over each circle and click for detailed information on violations for each inspection date.</p>

    <!--<p class="estab_page_text"> &mdash;this is a paragraph detailing the city's policy about how thye inspect restaurants. i'd write in here for example how they inspect restaurants more often when they're doing poorly and progressive less often as they get better.  i'm not sure what the threshold is.&mdash;</p>  
    </div>-->

</div>
{% endblock %}